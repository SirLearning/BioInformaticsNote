# 先验

## 先验知识：

Python, R

数据库

重要的是抓紧时间学会python和linux

## 数据与数据库：

数据库集合网站：NAR Database Category List

大型数据库网站：

1. NCBI
2. EBI
3. SIB Expasy
4. NGDC（BIGD）

数据库使用注意事项：

安全问题：不要将公司或者是私人信息发送到web server

科学可重复性：

- 记录使用的数据库
- 记录使用的程序
- 记录程序版本号

- 记录序列的accession numbers：在不同的database中会有不同，所以要记录database IDs以及选取最大的一个数据库。

- 记录程序参数 -- 写lab book

保存：

- Flashy graphs: 发表以及查看
- ASCII(text) files: 之后的工作
	- MSAs: xxxx.aln
	- Trees: xxx.dnd, xxx.ph

检查不同程序的边界值(borderline results)：检查其准确性

- 多用几个程序，来缩小误差概率，最后的结果用一致性检验和一致的方法来做对比和取最佳结果（consistency-checking; consensus approach）

注意unpublished methods（当然发行过的也不一定是好的）

Data选用新的最好

大多数资源对学术是free的，但面向公司的都是付费的。

构建数据库需要注意的事情：

- 抢占先机: clustalw
- 持续维护: PlantTFDB, AnimalTFDB
- 软件和数据库的依赖性: OS

## 文献检索

引文网站：

- NCBI PUBMED
- Web of Science

学术搜索：

- Google scholar
- Google or bing.com

出版社：

- Springer-Nature
- Elsevier Science
- HighWire Press
- Wiley Press
- Oxford

文献管理：

- Endnote

# NCBI+国内数据库

## NCBI

NCBI e-utilities:

- Search, link, and download sequences of genebank programatically

Batch Entrez: 

- 输入一个Entrez accession numbers的文件，会输出下载所有的有关记录

使用：

- 最常研究的DNA功能片段叫什么

NCBI Gene: integrates information from a wide range of species

- Nomenclature：术语
- Genomic：基因组信息
- Expression
	- GEDS: gene expression display server
- Biblography: 相关文章
- GeneRIFs: gene reference into functions
- Pathways from Pubchem
	- Wikipathways: 生物学通路数据库
	- Reactome
- Maps
- Interactions: 相互作用
- variations：突变体
	- Genotypes
	- SNP
- Phenotypes: 表型
- Disease:
	- OMIM: 人类基因和基因表型的汇总，内容较深刻
		- a comprehensive, authoritative compendium of human genes and genetic phenotypes
	- OMIM-PCNA
- General gene information
	- Markers: 标记
	- Pseudogene(s): 假基因
	- Homology: 直系同源
	- Ontology: 功能（如药用）
- RefSeqs
	- 转录型（可变剪切）
	- Genomic: 基因组信息
	- Related sequences
	- RefSeq ID: 
		- NM_xx, NP_xx, NR_xx, NC_xx
		- 小数点后有数字才是唯一的mRNA序列，这个是版本号

| Accession prefix |                        Molecule type                         |                           Comment                            |
| :--------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|       AC_        |                           Genomic                            |    Complete genomic molecule, usually alternate assembly     |
|       NC_        |                           Genomic                            |    Complete genomic molecule, usually reference assembly     |
|       NG_        |                           Genomic                            |                  Incomplete genomic region                   |
|       NT_        |                           Genomic                            |           Contig or scaffold, clone-based or WGSa            |
|       NW_        |                           Genomic                            |              Contig or scaffold, primarily WGSa              |
|      NZ_^b^      |                           Genomic                            |           Complete genomes and unfinished WGS data           |
|       NM_        | [mRNA](https://www.ncbi.nlm.nih.gov/books/n/handbook/A1237/def-item/app114/) |         Protein-coding transcripts (usually curated)         |
|       NR_        | [RNA](https://www.ncbi.nlm.nih.gov/books/n/handbook/A1237/def-item/app158/) |                Non-protein-coding transcripts                |
|      XM_^c^      | [mRNA](https://www.ncbi.nlm.nih.gov/books/n/handbook/A1237/def-item/app114/) |          Predicted model protein-coding transcript           |
|      XR_^c^      | [RNA](https://www.ncbi.nlm.nih.gov/books/n/handbook/A1237/def-item/app158/) |        Predicted model non-protein-coding transcript         |
|       AP_        |                           Protein                            |             Annotated on AC_ alternate assembly              |
|       NP_        |                           Protein                            |           Associated with an NM_ or NC_ accession            |
|      YP_^c^      |                           Protein                            | Annotated on genomic molecules without an instantiated transcript record |
|      XP_^c^      |                           Protein                            |      Predicted model, associated with an XM_ accession       |
|       WP_        |                           Protein                            |      Non-redundant across multiple strains and species       |

(

^a^ Whole Genome Shotgun sequence data.

^b^ An ordered collection of [WGS sequence](https://www.ncbi.nlm.nih.gov/books/n/handbook/A1237/def-item/app195/) for a genome.

^c^ Computed.

)

- links to:
	- HomoloGene
	- Genetic Variations:
		- SNP(single nucleotide polymorphism): 单链多态性
			- SNP
			- SNP: geneview
		- Variation viewer:
			- SV(structural variation)
			- CNV(copy number variation)
		- ClinVar: 有关人类健康的基因组变异
		- dbVar: 人类基因组结构变异数据库
		- Mutation
	- Genome
	- phenotype
	- locus-specific resources worldwide.

GeneCards: 人类基因数据库

EBI：维护着世界上最全面的分子数据资源

​	EBI sequence analysis

​		MSA,

​		EMBOSS: The European Molecular Biology Open Software Suite

## 学术圈：

顾孝诚

吴瑞

CUSBEA：生命科学公派留学

ICGEB

CBI：北京大学生物信息中心

郝柏林：理论物理学家转生信

## 国家生物信息中心（CNCB）：

原始测序数据归档库：genome sequence archive(GSA)

- 特点：在国内，更加快速
- 数据库：
	1. 基因组序列库：genome warehouse
	2. 基因组变异库：genome variation map
		- dbSNP & dbVar: 不再接收非人类的突变数据
	3. 2019新型冠状病毒信息库
	4. 基因表达数据库：gene expression nebulas
	5. 人类长非编码RNA数据库
	6. 甲基化数据库：methbanl
	7. 脑疾病知识库：brainbase
	8. 特色物种基因库

- 工具：
	- 生物大数据算法与工具
		- CloudPhylo:
		- Identification of long non-coding RNAs based on feature relationship
	- 生物大数据跨库搜索引擎：BIG Search

生物多样性多维数据资源平台

精准医学多维数据资源平台

# Gene

## 基因结构

### 测序 – 注释

注释 Annotation: 用计算机和实验的方法来标注基因组

- Four levels of annotation：预测(where)、相似性(like)、结构域(do)、通路作用(pathway)

Genes: 

- Types:
  - RNA genes
  	- tRNA, rRNA, snRNA, snoRNA, microRNA
  - Protein coding genes:
    - Prokaryotic gene model 原核基因结构: ORF-genes
      - small genomes, high gene density: Haemophilus – 85% genic
      - Operons: one transcript, many genes
      - No introns: one gene, one protein
      - Simpler regulatory features
      - Open reading frames: One ORF per gene(start – stop condon)
    - Eukaryotic gene model 真核基因结构 : spliced genes
      - Posttranscriptional modification 后转录修饰: 5’-CAP – polyA tail
      	- acceptor site – donor site
      - ORF: mature mRNA, all internal exons
      	- UTRs: pre-start, post-stop
      - multiple translates
- Human gene: 22K genes code for about 100,000 protein

  - Karyotyoe: 46, linear
  - Genomic sequence features:
  - seqence type: 
  	- Repeats(junk DNA): about 50%
  		- RepeatMaster
  	- coding genes: 20,338(Ensembl) 1%, 1/3为多拷贝
  		- transcripts: 200,000
  		- Consortium(35,000), Celera(30,000), Affymetrix(60,000), Incyte and HGS(over 120,000), GenBank(49,000), UniGene(>89,000)
  		- intron: 30bp～数十kb不等，内含子的平均长度3413.1bp
  		- exon: 一般不长于800bp, approximatedly 180,000
  			- flanking untranslated regions(5’ UTR and 3’ UTR)
  			- Exon with 3’UTRs str c
  			- on average 9 exons per gene
  		- mRNA剪接位点（Splicesites）：GT－AG法则（内含子）
  			- 5’端大多数是GT（称为donorsite）开始
  			- 3’端大多数是AG（称为acceptorsite）结束
  	- Pseudo genes: 14,638 假基因，会对找寻真基因造成困扰
  	- Non-coding RNAs (ncRNA): tRNA, rRNA, snRNA, snoRNA, miRNA
  		- tRNASCAN-SE 一个perl脚本，整合了tRNAscan, EufindRNA, Cove三个独立的tRNA检测软件
  	- Mitochondrial genes: 37(code for 22 tRNAs, 13 proteins and 2 tRNAs)
  	- microbiome flora

Karyotype 染色体组

Statistics:

Human genome:
- Haploid(单倍体) nuclear genome size (3.0×10<sup>9</sup>)
- Highly conserved regions：
	- Coding DNA covers about 30 Mbp (1%)
	- Other regulatory regions cover about 100 Mbp (3%)
- Repetitive DNA covers more than 50%
- Segmental duplication: more than 5%
- Endogenous(外源) retroviral(逆转录病毒) genomes (ERVs): 5-8% (inherited 遗传的)
- Other associated genomes
	- Mitochondrial genome: about 16.5 Kbp, circular genome
	- Viral(病毒) genomes (transfected exogenous Retroviruses)
	- Microbiome 微生物群 (~3,000 microbes are estimated to harbor(隐藏在) human body)

Human gene/protein:
- About 22K genes code for about 100,000 proteins in human
- Mitochondrial genes: 37 (code for 22 tRNAs, 13 proteins and 2 rRNAs)
- About 3.5 million genes encoded by about 3000 microbiome flora
	- Oral microbiome, gut microbiome, etc.
- Coding genes: 20,338 (source Ensembl)
- Pseudogenes: 14,638
- Gene transcripts: 200,000

Human exome(外显子组):
- Some exome capture kits：
	- protein coding regions
	- the flanking untranslated regions (5'UTR and 3'UTR)
- Exome studies usually include all the protein coding regions covering about 30 Mbp of DNA (~1%)
- Human genome has approximately 180,000 exons
- On average there are 9 exons per gene, but the number varies by gene length, which ranges from 1-363. The Titin gene (TTN) has 363 exons.
- Average exon length is about 122 bp

Sequence of an organism's genome:
- Genes
- Exon boundaries & splice sites
- Beginning and end of translation
- Alternative splicing
- Regulatory elements
	- Promoters

## 基因预测

基因预测（Gene Prediction）

- Ab initio 从头预测: 基于统计规律或信号检测
	- 编码区域字符上下文特殊
	- 氨基酸同义密码子选择的偏好性
	- 基因结构特定位点信号识别基因：
		- 剪切信号: splice sites, GT-AG
		- 起始密码子: start site/codon(ATG)
		- 终止密码子: stop site/codon(TAA, TAG, TGA)
		- 启动子: initial
		- 终止子: terminal
- 同源预测: 基于相似性比较
	- 基于功能的相似性
	- 编码序列比组成型序列更加保守
- RNA-seq, EST 表达数据: 基于表达数据
	- 二代测序RNA-seq：组装获得完整基因
	- 三代测序RNA-seq：可直接获得部分表达基因的完整序列
	- PCR获得的RNA及EST序列：可用于验证基因

基因识别（Gene Identification）

- Promoter,
- transcription start, 
- 剪切位点识别: Splice signals(GT, AG)
	- Acceptor site: 3', AG
	- Donor site: 5', GT
- Poly-A site(多腺苷化信号识别),
- 蛋白编码区的识别, 
- Intron/exon
- 核糖体亚单位：

基因寻找(Gene Finding), Signal detection: : promoters, start/stop condons, splice sites…

- Methods
	- Consensus strings
	- Pattern recognition
	- Weight matrices(矩阵) -- score
	- Weight array matrices
	- Maximal dependence decomposition(MOD)
	- Hidden Markov Models(HMM)：
		- 典型基于HMM的基因预测系统：
			- VEIL
			- HMMgene
			- GeneMark.hmm
			- Genie
			- GENSCAN
		- Simple HMM M for gene detection: 'in exon' and 'in intron'
	- Neural Networks(NN)
- Splice site detection: weight matrices -- hidden markov models

基因注释（Gene Annotation）

生物学信息：

Genome database: HGP (human genome project)

## Ensembl: 欧洲

Ensembl Genes: protein/mRNA + sequence assembly

- base: UniPort/Swiss-Prot, UniProt/TrEMBL, NCBI RefSeq
- Flow
	- align species-specific protein
	- align similar proteins (related species)
	- add UTRs using mRNA information
	- build transcripts using mRNA evidence – build additional transcripts using ab initio predictors and homology evidence
	- combine gene annotations with alternative transcripts
- ID:
	- human: ENSG/T/P/E### (gene/transcript/peptide/exon)
	- other species like Mus musculus: ENSMUSG/T/P/E###
- gene structure:
	- UTRs: no UTRs, UTRs annotated
- database: species – 300多个基因组
- Human Genome:
	- genome assembly
	- comparative genomics
	- regulation
	- gene annotation
	- variation
- 3 level browse:
	- Gene
		- summary: gene alleles
			- plice variants
		- sequence: secondary structure
		- comparative genomics: 
			- genomic aligments, 
			- gene gain/loss tree, 
			- orthologues
		- ontologies: GO(gene ontology)
		- phenotypes
		- genetic variation
			- Variant: table/image
		- regulaton: ENCODE, Tarbase
		- external references
		- ID history
		- export data
	- Transcript: show transcript table
		- RefSeq match
		- transcript level
		- sequence: exons, cDNA
		- variant table
	- Protein
		- domain feature
- Tools:
	- assembly converter
	- ID history converter
	- BioMart: search engine, data-mining tool
		- search item: 
			- human gene (IDs), chromosome, base pair position
		- attribute
		- filters
		- data sets:
			- Ensembl genes, Vega genes, SNPs
			- Markers, Phenotypes, expression, ontology, homology presictions, annotation
		- know the IDs of one gene in both Ensembl and MGI(markersymbol ID)
		- HapMap
	- BLAST(basic local alignment search tool)
	- BLAT(BLAST-like alignment tool): faster
		- 对基因组做
	- variant effect presictor: 
		- analyse variants
		- 预测变异的潜在影响
		- 搜索匹配已知变异
- sister sites: different species
- open source – user projects with own data
- pre and archive sites

## Ensembl biomart



# Genome

## UCSC genome browser: 美国

select:

- species
- appropriate assembly
- gene

result:

- genome location
- gene ID and sequence
- expression
- found from different cell lines
- DNase I hypersensitivity clusters
- DNA conservation
- aa conservation
- SNPs in dbSNP
	- synonymous, missense or splice variants, intronic, UTR
- repetitive or complexity regions

Transcript details

Track groups:

- mapping and sequencing
- genes and gene predictions
- phemotype and literature
- EST
- regulation
	- ENCODE (DNA元件百科全书): 描述功能性元件
		- ENCODE cCREs (candidate cis-regulatory elements): 
			- subset of representative DNase hypersensitive sites
		- ENCODE regulation tracks
			- TF ChIP

Tools

- my data – custom tracks / add custom tracka
	- BED (browser extensible data): positonal annotations
		- ChIP-seq signal for TF binding
		- required field:
			- chrom
			- chromStart
			- chromEnd
	- GFF: DNA功能片段注释 – posions of all data items in a limited gene transfer format
	- wig(gle): continuous signal data
		- DNase I HS, ChIP-seq signals
	- BAM: alignments of seq
		- RNA-seq alignments
	- VCF (variant call format): variation data format
		- SNPs, ExAC data

integrative gennomics viewer (IGV): view next generation sequencing data

- loading large datasets (>~100mb) and a large number of samples

ExAC browser (exome aggregation consortium)

- looking up contextual information for NGS data such as allele frequencies

UCSC genome browser

- 找注释，只有很少的 small files

## UCSC Table Browser

作用：advanced searching

Tables – Table brower

- Genomes
- Data
- Location
- Filter and intersect
- output

create a custom track:

- define track characteristics
- define browser characteristics
- format the data
- upload and view the track in genome browser

track characteristics:

- pairedReads: default view is pack
- Gap: default view of other tracks set

## DOE Joint Genome Institute (JGI)

bioenergy research at JGI

program:

- fungal genomics program
	- MycoCsm
- metagenomics(宏基因组学) program
- microbial genomics program
	- Archaea
	- Bacteria
- plant genomics program
	- phycocosm – algal genomics

Genome DB for one organism

# Protein

## Protein database

### general protein databases

Expasy (SIB) – UniProtKB/Swiss-Prot

- UniPort knowledgebase – uniprotkb

TrEMBL – translated EMBL – UniProtKB/TrEMBL

- 有 high-quality computationally analyzed records
- enriched with automatic annotation
- translations of annotated coding sequences from
	- EMBL-bank
	- genbank
	- DDBJ nucleotide sequence database
- from PDB
- from gene prediction
	- Ensembl
	- RefSeq
	- CCDS

UniProt

- UniPortKB (uniprot knowledge base)
	- 两类：
		- uniprotkb/swiss-prot: manually annotated and reviewed
		- uniprotkb/TrEMBL: automatically annotated
	- popular organisms
	- ID：字母嗯好数字的组合
- UniRef (uniprot reference clusters)
	- 提供蛋白质序列的clustered sets
	- 从UniProtKB和UniProt Archive records中获取覆盖整个蛋白质空间的 数据
	- 有多种方式来隐藏冗余的序列(根据百分比来筛选方式)：
		- UniRef100: 特征序列+亚片段+11个或更多的残基(从任何生物中) – 形成一个单UniRef entry
		- UniRef90: 聚集UniRef100的序列成束
			- 每一束由与最长序列90%一致、80%重叠的序列组成
		- UniRef50: UniRef90的种子序列组成
			- 每一束由与最长序列50%一致、80%重叠的序列组成
- UniParc (uniprot archive)
	- a comprehensive and non-redundant repository
	- 包含所有主要公开数据库中的蛋白序列
- Proteomes
	- 包含物种全部测序的基因组

### 蛋白结构数据库

PDB (Protein Databank)

- 不仅有蛋白结构，还有核酸和多糖结构
- ID：
	- 第一个符号：1-9数字
	- 第二到第四：数字字母均可
- entry
- 3D view – 序列标注视图

AlphaFold DB (AlphaFold Protein Structure Database)

- 平均已经取得实验测定结构的准确程度

### 功能数据库 (domain, function site)

Pfam:

- 两个内容：
	- Pfam-A entries：被很好维护的families
	- Pfam-B entries：自动生成的entries
		- 使用ADDA数据生成的对Pfam-A的补充
		- 质量较低
		- 用于鉴定当没有Pfam-A时的功能保守序列
- HMM Search
- Pfam Search

SMART

- 两种模式：
	- normal
	- genomic

motif databases: Scan Prosite, PRINTS

- store：保守的模体 – 核酸/蛋白序列
- 保存方式：
	- consensus sequences
	- aligments
	- statistical representations: residue frequency table

Interpro：蛋白质功能数据库的整合

- members: 
	- CDD, Pfam, PRINTS, SMART, 
	- PROSITE profiles, PROSITE patterns
	- CATH-Gene3D, HAMAP, PANTHER, PIRSF, SFLD, SUPERFAMILY, TIGRAMs
- entry type:
	- domain
	- family
	- homologous superfamily
	- repeat
	- sites:
		- conserved site
		- active site
		- binding site
		- PTM
- species
- domain architectures: 与其他domain一起的组合
- search – 可直接用domain搜索
- Browse

Gene Ontology (GO)

- 一项倡议(initiative) – 标准化物种/数据库间，基因和基因产物的属性的表示
	- a contrilled vocabulary of terms
	- gene product annotation data
	- tools to acccess and process this data
- GO enrichment analysis
- evidence: GO注释(annotation)格式中需要有的部分
- 不同系统，如免疫系统的GO标记
- browse – drill-down browsing – interactive tree
- search the ontology

KEGG (Kyoto Encyclopedia(百科全书) of Genes and Genomes)

- KEGG PATHWAY Database
	- metabolism
	- genetic information processing
	- enbironmental information processing
	- cellular processes
	- organismal systems
	- human diseases
	- drug development

National Cancer Institute

- Cancer Genome Anatomy Project – pathway
- Erk1/Erk2 Mapk signaling pathway

PPI database:

- HPRD
	- browse
- BioGrid (biological general repository for interaction datasets)
- BIND
- MINT

## prediction of protein function (PFP)

在GO的分类中，有41.7%的蛋白功能是未知的

function的定义：

- 结构
- 细胞学
- 医学

可利用多种方式来预测蛋白质的功能

### PFP from homology

- detection 检测同源性
	- pairwise序列相似性搜索: BLAST, FASTA, full Smith-Waterman
	- profile-based similarity searches: PSI-BLAST, HMM
	- 序列相似性应当在蛋白质层面被评估
- 相关表征：
  - sequence homology(蛋白有共同的祖先基因)
  - sequence similarity(序列的相似值，是准确值)
  - functional homology(不同物种中的蛋白有相似作用) – 与SH和SS没有相关性
- 类型：
  - 基因复制，造成不同的基因功能变化：
    - neofunctionalization(新功能化)
    - subfunctionalization(亚功能化)
    	- 每一个复制基因起部分原始基因的功能
    	- 功能的同源性无法被定义
    	- 每一个直系同源有相同的分子功能，在不同的亚过程或位置
  - 保留原始功能 – orthologs 直系同源
  	- 类型：
  		- 1-to-1 orthology：不同物种的单基因功能相同
  			- same: molecular function/biological process/localization
  			- 在原核生物和联系较紧密的物种中产生
  		- 1-to-many orthology：一个物种中的单基因与另一个物种中定点多基因相联系 – mixture of neo- and sub-functionalizations
  			- same: molecular function
  			- different: biological process/sun-process/sub-cellular localization/tissue
  			- 在简单模式生物嗯好高级真核生物中常见
  		- many-to-many orthology：多物种的多基因，都是从同一原始基因发展而来的 – 不同的sub和neo功能化发生在不同的物种中
  			- same: molecular function
  			- different: biological process/sun-process/sub-cellular localization/tissue
  			- 在较远联系的高等真核生物间常见
  	- detection 直系同源的检测：
  		- 重建立系统发生树(phylogenetic trees) – 理论上最正确的方式 – 分析特定的基因
  		- reciprocal matches 相互匹配：一对一，正反向找到一个
  			- best reciprocal matches 相互最佳匹配
  				- 简单的相互最佳匹配只适合1-1 orthology
  			- detection of in-paralogsm – orthologs detection
  			- DB: inparanoid, COGs
  		- manual curation – synteny, protein function
  - 改变功能 – paralogs 旁系同源
- construction of gene trees
  - 检测相关蛋白 – 序列相关性
  - 建立a blocked MSA(multiple sequence aligment)
  - 重建most likely phylogenetic tree
  - trivially extract orthologs and paralogs

### PFP from domains

功能信息较少 – 可能序列同源性比对没有结果

domain:

- 真核蛋白含有许多globular domains，可以独立折叠出空间构型
- 在进化中，这些domains变得统一
- 使用HMMs来从序列鉴定这些domains

HLH DNA binding domain

定位信号

- SMART – signal transduction domains
- Pfam – have the most up-to-date domain collection
- interpro – genome annotion – the domains are annotated with GO terms
- NCBI(CDD) – 接入NCBI的BLAST界面

E-value: 越低越好，序列越长越低（不容易碰到）

### PFP from motifs

类型：

- transmembrane helices
- disordered regions 
- Eukaryotic linear motifs(ELMs)
  - types:
  	- modification site – 磷酸化位点
  	- ligand peptides – SH3 binding site
  	- 目标信号 – nuclear localization sequences
  - prediction:
    - 条件：
      - 大多功能模体缺乏信息，难以从序列上预测：
      	- 低一致序列 – 简单的一致序列随处可见
      		- 准确性更高的PSSMs, ANNs, SVMs也不够准确
      	- 典型的ELM只有三个保守残基 – 过小而难以定位
      	- 允许一些变体
      	- ELM包含的完全信息不在位点处
      - fewer and smaller DB: 相比于domains的数据库，含有更少的例子
        - ProSite(被整合): 
        - ELM: 功能之一是motif discovery and search tools(纯找片段)
      - curation(对数据的综合处理)更加困难
      	- domain数据库可以通过蛋白质序列建立
      	- functional motif数据库必须通过实验验证来验证
      - 预测功能模体的行为：
      	- 信号肽
      		- signal found
      			- N-ter – exportation – secretion – mitochondria – chloroplast
      			- internal – NLS
      			- C-ter – GPI-anchor
      			- other membrane anchors
      		- signal dectection tools
      			- SignalP
      			- MitoProt
      			- ChloroP
      			- Predotar
      			- PSort
      			- TargetP
      			- Sigcleave (EMBOSS)
      			- Phobius
      			- Big-PI
      			- DGPI
      	- 跨膜结构域和拓扑结构
      		- detection: signal peptide, hydropathy, helices
      			- tools
      				- TMHMM
      				- TMPred
      				- TopPred2
      				- DAS
      				- HMMTop
      				- Tmap (EMBOSS)
      				- Phobius
      				- ConPred II
      		- organisation: topology
      	- 转录后修饰 post-translational modification(PTM)
      		- 种类:
      			- phosphorylation 磷酸化 – S-T-Y
      				- NetPhos – 真核
      				- GPS
      			- N-glycosylation N-糖基化 – N
      			- O-glycosylation O-糖基化 – S-T-(HO)K
      				- NetOGlyc – 哺乳动物蛋白
      				- DictyOGlyc – GlcNAc – 网菌属
      				- YinOYang – O-beta-GlcNAc – 真核
      			- Acetylation 乙酰化, methylation 甲基化 – D-E-K
      			- sulfation 硫酸盐化 – Y
      				- Sulfinator
      			- farnesylation 法尼基化, myristylation 十四烷化, palmitoylation 棕榈酰化, geranylgeranylation 香叶酰香叶酰化, GPI-anchor – C-Nter-Cter
      				- N端十四酰化 – NMT
      			- ubiquitination family 泛素化 – K-Nter
      			- inteins (protein splicing) 内含肽
      			- pre-translational 转录前– selenoprotein – C
      		- detection:
      			- pattern prediction – PROSITE
      			- experimental – MS/MS detection
      	- domains/motifs
      		- descriptors:
      			- PROSITE
      			- Pfam
      			- SMART
      			- PRODOM
      			- BLOCKS
      			- PRINTS
      			- TIGRfam
      		- federation – InterPro
      		- techniques
      			- patterns, Regexp
      			- PSSM (PSI-BLAST)
      			- Profiles
      			- HMM
      	- coils 盘绕
      		- helix of helix – coiled-coil
      		- Leu-zipper
      		- detection:
      			- COILS – 权重矩阵
      			- Paircoil, Multicoil – pairwise
      			- Marcoil – HMM
      			- Pepcoil (EMBOSS) – 权重矩阵
      	- 二级结构：准确度为70-80%
      		- structure: &alpha;-helices, &beta;-sheets, turns, random coil
      		- tools:
      			- Garnier (EMBOSS)
      			- PHD
      			- DSC
      			- PREDATOR
      			- NNSSP
      			- Jpred
      			- Jnet
      	- 低复杂度片面区域 low complexity regions
      		- repeats
      			- DUST(DNA)/SEG – 从头检测
      			- RepeatMasker(DNA) – 搜索合集
      			- REP – 搜索合集
      			- REPRO, Radar – 从头
      			- PEST, PESTFind – 从头
      			- EMBOSS(DNA)
      				- einverted/equicktandem/etandem
      				- 回文
      			- EMBOSS(protein)
      				- oddcomp
      		- compositional bias
      	- 抗原性肽链 antigenic peptide: 连接MHC的肽链
      		- MHC：编码动物主要组织相容性抗原的基因群的统称
      		- 分类：
      			- class I – 8, 9, 10 mers
      			- class II – 15 mers(3+9+3)
      		- tools:
      			- SYFPEITHI
      			- HLA_Bind (BIMAS)
      			- MAPPP combined expert
      			- Antigenic (EMBOSS)
      			- 预测蛋白酶体切割位点 – NetChop/PaProc
    - algorithms:
    	- sliding window – transmembrane
    	- nearest neighbor
    	- patterns/regular expression
    		- Pattern：人工智能+运算, PSSM权重矩阵
    		- Regexp
    	- weight matrices – PSSM
    	- HMM/profiles
    	- neural networks
    	- rules

### GO/pathway/PPI network

gene ontology(GO) – controlled vocabularies

- molecular function – activity – 在GO中不区分发生的背景/时间/环境
	- catalytic activity
	- binding activity
	- transporter activity
- biological process – 如嘧啶代谢等，是molecular function的有序组装
- cellular component – 细胞中原有的结构 – 解剖学结构/基因生产组(核糖体、蛋白酶体、蛋白二聚体等)
- 工具：
	- AmiGO – browse GO
	- Blast2GO – 搜索方式
		- GO terms
		- InterPro domains
		- RFAM IDs
		- enzyme codes
	- BlastKOALA – blast KEGG
		- Knumber
		- GhostKOALA
		- KEGG pathways

EcoCyc pathways

PPI network：数据库集合 – database

- HPRD
- BIND
- BioGrid
- DIP
- IntAct
- MINT
- IntNetDB

STRING network

- 7种不同颜色的线：
	- 红 – fusion evidence
	- 绿 – 邻近证据
	- 蓝 – 同出现
	- 紫 – 实验
	- 黄 – 文本挖掘数据 textmining evidence
	- 浅蓝 – 数据库证据
	- 黑 – 共表达

### PFP from co-expression：很多次看到，就有相互作用

- COXPRESdb：基因表达数据库
- WGCNA：权重网络的R包
- CoExp：web tool – 共表达网络的开发

# Next generation sequencing (NGS)

## Next generation sequencing (NGS)

二代测序 technologies:

- 454
- SOLID
- Illumina
	- HiSeq

sequencing steps/pipeline:

1. library preparation
	- 加DNA – 碎片化 – 加接头end repair & adaptor ligation (连接复制) – 碎片库
2. library amplification 碎片与板子上特定位点的吸附 – 连接 – 合成, 延伸(束状生长)
3. parallel sequencing 
4. data analysis

Illunina data processing

1. nucleotide flows – raw images
2. image processing – base-calling – quality filtering – .bcl
3. 质控(截掉质量值不好的测序结果) – Illumina fastq

应用：

- 基因组学(genomics):
	- 全基因组测序 whole genome sequencing(WGS)
	- 全外显子测序 whole exome sequencing(WES)
	- 数据分析：
		- 点突变/插入缺失标记/复制数变异/结构变异
- 转录组学(transcriptomics):
	- RNA测序
		- 原理：
			- 大型平行测序
			- complementary DNA(cDNA) – next-generation short read technologies
			- reference genome – transcriptome map
		- 流程：
			1. 实验设计
				- 分组(control和实验组)
				- 物种(organism): novel/non-model/genome-sequenced/model
			2. 样品准备
				1. 提取poly-A RNAs
					- polyA selection
					- rRNA depletion – ribozero/ribominus
				2. 转换成ds-cDNA and shearing
				3. 亲和吸附 – adapter连接
			3. 测序：
				- single end (SET)
				- paired end (PET)
			4. data quality control
			5. RNA-seq reads – 数据分析
				- mapping reads – reference genome
				- visualization(Gbrowser)
				- de novo assembly
				- quantification
			6. differential expression analysis – reference transcriptome
		- 结果：
			- 基因/转录/外显子表达，选择性剪切，基因融合，单核苷酸变异
			- 新的转录区域，Allele-specific expression，RNA编辑，非模式生物的转录组
		- 优势：
			- 不需要已存在的序列 – reads很清晰 – 分辨率高 – 高生产量 – 可以揭示序列变异(SNPs)
	- sRNA(small RNA)测序
	- 数据分析：
		- 表达差异化/基因融合/选择性剪切/RNA编辑
		- RNA测序分析：
			- RNA types
			- phenotypes
			- transcriptome
				- gene structure
				- 选择性剪切(alternative splicing)
	- evolution:
		1. gene expression profiling – spotted cDNA microarray – 已知基因的表达水平
		2. whole genome expression profiling – tiling array – 辨识和检测新基因和剪切变异体
		3. mRNA测序 – NGS – mRNA-seq
- 表观遗传学(epigenomics):
	- ChIP-seq/ChIP-exo
	- CLIP-seq
	- Bisulfite-seq
	- 数据分析：
		- 甲基化/组蛋白修饰/转录因子结合
- single cell sequencing (sc) 单细胞测序

RNA-Seq

FastQC – quality

dup

## Transcriptome and RNA-seq analysis

# 测序分析

## Genome assembly and annotation

3D genome	

- 有些基因一维离的远，三维离的近
- HiC-seq
	- HiC作用：

## Exome-Seq

家系遗传病

成本较低，数据量少很多

生物芯片 – 外显子芯片 – 富集外显子

- 系统生物学
- 多个探针加到一个片子上，用荧光等来检测

## ChIP-seq

核小体

实验流程

- formaldehyde
- sonication – shear
- antibody
- cross-links reversed
- build library – sequencing
	- 找到相关位置 – 两端测序

data analysis workflow:

- quality control – fasta, fastq
	- FastQC
- read mapping – sam, bam
	- Bowtie
	- BWA
- peaks calling – bed, wig, bigwig
	- 双峰，中间的
	- MACS2
	- SPP
- visualization
	- IGV
- repetitive regions
- annotation
	- ChIPpeakAnno – R包
	- ChIPseeqer
	- CEAS
	- GREAT
	- RegProtential
	- motif scan/MDSeqpos/meme

测序片段比较短

![image-20221124115822722](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124115822722.png)



## ATAC-seq

assay for transposase accessible chromatin, DNA转座酶、高通量测序、染色体的可进入性

利用转座酶研究染色质可及性的高通量测序技术

表观遗传学研究技术

# 组学分析

## miRNA组学分析

miRNA

- miRBase – database
- 通过物种搜索
- 作用机制：
	- 结合nRNA 3’端UTR – 抑制表达
	- 完全匹配结合mRNA – 切割，类似RNAi
- 参与生物体生长、发育、衰老、疾病和死亡的调节
- question:![image-20221124140325679](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124140325679.png)

miRNA-seq/smRNA-seq

- smRNA:
- small RNA-seq经常用于鉴定miRNA的表达
- pipline:
	- 准备smRNA
	- sequencing
		- single read (SR)
		- paired end (PE)
	- data analysis
	- tools
		- quality
			- question:![image-20221124142427585](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124142427585.png)
		- trim
		- alignment to genome
			- map to genome
			- common alignment conventions
			- remove other non-coding RNA
		- map to mirna_precursor
		- miRNA expression
			- RPM
			- RPKM
			- numReads
			- geneLength
			- totalNumReads
		- differential expression analysis
			- 标准化方法
			- 差异基因检测
		- novel miRNA discovery

miRNA

- expression
- SNP (single-nucleotide polymorphism)
	![image-20221124144552457](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124144552457.png)
- Target prediction
	- seed – binding site
	- 结合最小自由能
	- question:
		![image-20221124144954761](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124144954761.png)
- disease databases

annotation – TAM

miRNA & lncRNA

## TCGA

the cancer genome atlas 癌症基因组图谱

- 人类20多种癌症中全基因组图谱改变中所需的研究框架
- 合作机构：
	- national cancer institute (NCI) 美国国立癌症研究所
	- national human genome research institute (NHGRI) 美国国立人类基因组研究所
- 部门：
	- TSS – 临床数据
	- BCR – 技术类型数据
	- DCC – 数据协调中心
	- GCCs/GSCs – 鉴定中心/测定中心
- 数据组织形式：barcode
- 数据发布：genomic data commons (GDC平台)

data type:

- clinical data
- images
- microsatellite instability (MSI)
- sequening:
	- DNA/miRNA/mRNA/total RNA
- protein expression
- array-based expression
- DNA methylation
- copy number

data level: raw/processed/segmented(interpreted)/summary(regions of interest ROI)

低水平测序数据 – CGHUB

## TCGA

肿瘤相关，是一个项目组织: 癌症基因组计划

团队组成：

- TSS
- BCR
- DCC
- GCCs/GSCs

barcode: 定义病人样本

GDC: 数据发布平台

数据类型：

- raw – fastaq
- processed – sam(测序), fam
- se/int
- ROI

# 测序分析

## Functional Enrichment Analysis

questions:
![image-20221124161610713](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124161610713.png)

Enrichment Analysis: statistically比较一个gene set和background

- 分类：
	- genomics, proteomics – 对一个物种的全部注释
	- microarrays – 对一个gene set的全部注释\
	- RNA-seq data analysis – 特定组织中的基因长度趋势效果
- gene list:
	- identifier
	- method
- workflow:
	- 后端注释数据库 annotation database
	- data mining：要输入一个gene list
		- algorithms – annotation – diff.discovery ideas
			- sources
		- 数据检验 statistics：
			- hypergeometric
			- binomial
			- &chi;<sup>2</sup> (chi-square)
			- Fisher’s exact test
			- &Zeta;
			- Kolmogorov-Smirnov
			- Permutation
	- 结果 – GO terms

question:
![image-20221124164456876](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124164456876.png)

## GEO SRA

### GEO

gene expression omnibus – NCBI基因表达数据库

数据组织方式：

- platform(GPLxxx)/samples(GSMxxx)/series(GSExxx)
- dataset(GDSxxx)/profile(表达谱)

cluster

tools:

- GEO2R

### sequence read archive (SRA)

throughput sequencing data

共享有史以来所有用户的测序数据

## 单细胞测序

单细胞技术：研究胚胎发育中早期细胞变化

- 背景
- 需求 – 癌细胞混合物
	![image-20221124185339862](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124185339862.png)

### 10&times;genomics高通量单细胞技术

微流控技术: 自动化分选平台 – 单细胞转录组测序，自动完成：

- 分选细胞 – 分析注释 – 特定细胞亚群marker基因
	- 自动化分选：一次10000个细胞，对成活率有要求
		- 10&times;Genomics: 凝胶珠、油滴
		- single tube – smart-seq2
	- 单细胞转录组分析
- 建库

Single rube – 传统技术

### 单细胞获取+测序技术

单细胞获取：

- 有限稀释 limiting dilution
- 显微操作 micromanipulator
- 激光显微切割 LCM
- 流式细胞分选 FACS
- 微流控 microfluidics

amplification – genome

- multiple displacement amplification (MDA)
- multiple annealing and looping-based amplification cycles (MALBAC)

全转录组测序

- 单细胞全基因组测序 scWGS
- 单细胞外显子测序 scWES

- 扩增
- biopic

分析：

- 表达量分析/差异表达分析/聚类分析/功能分析
- mRNA/lncRNA差异分析/靶标预测及分析
- circRNA差异分析/circRNA来源分析
- 对primary tumors的单细胞测序分析：
	1. somatic(体细胞) mutation calling
	2. population analysis
	3. progression inferring (key genes)
		- key mutation
		- evolution analysis – Bladder Cancer (BTCC)

### 临床应用

diagnose 早期诊断 – invasive

prognosis 预后(预测后果)

个性化治疗

- target-drugs design
- cocktail treatment

动态监测

- tumor “stem cell” detection

肿瘤组学治疗分析：

- 遗传算法
- center – 找到血液中/脑脊液中的肿瘤因子
- 愈后
- 检测
- 试管婴儿胚胎单细胞检测 – 植入前遗传学诊断PGD

# 肿瘤组学分析GSCA

## 癌症数据分析平台

肿瘤组学数据

- 公共数据 – TCGA
	![image-20221124193118027](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124193118027.png)
	- GSCA workflow:
		1. gene set expression
			- gene set mRNA表达数据+cancer type – GSVA score
		2. gene set nutation
		3. immune
		4. TNM stage
	- cell cycle pathway
		- GSCA – mutation
	- oncomine
- 自测数据 – 肿瘤转录组数据
	- 肿瘤免疫分析
		![image-20221124193205611](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124193205611.png)
		- T cell receptor (TCR)
		- CharActerzing TCR reperToires (CATT)
	- 表达调控分析
		![image-20221124193227609](C:/Users/%E9%83%91%E8%BE%BE/AppData/Roaming/Typora/typora-user-images/image-20221124193227609.png)
		- human transcription factor (TF)
		- FFLtool – analyze with gene list
		- specifically expressed gene (SEG)

筛选关键分子 – 验证 – 功能研究

- 细胞系筛选 GEDS(gene expression display server)
- 细胞系鉴定 CCLA(cancer cell line authentication)

癌症DB/研究中心

- ICGC：癌症联盟
- GTEx: 正常死亡器官组学分析

Tumor immunology – 有一些没有响应 – 提高

免疫细胞疗法：

- 单细胞分析/每个免疫 – 费时费力
- T细胞亚型

# 课堂展示

a quantitatives(数量的) multivariate(多元) model of human dendritic(树状) cell-T helper cell communication

## abstract

dataset generation:

- distinct DC(dendritic cell) conditions – 
- DC communication molecules – 
- CD4 T cells – 
- T helper cytokines

modeling:

- $Y=XB+E$
- $\forall i\in\{1,...,n\},\\\{E_{i,1},...,E_{i,q}\}\sim^{lid}\sim N(0,\sum_q)$
- prediction: DC/T cell molecular associations

validation:

- computional validation:
	- stability selection
	- cross validation
- literature validation:
- systematic experimental validation
- validation of context-depent effects

## 研究方法

1. 往年PPT
2. 论坛
3. 官网
	1. 文献
	2. 算法
4. Wiki
5. 论文

## 概述

cibersort: 一种可以使用基因表达数据来估计混合细胞群中成员细胞类型的丰度分析工具

分工：网页 – R代码 – PPT – pre

### 原理

免疫浸润 – 肿瘤组织内外都有很多免疫细胞 – 判断免疫细胞的组成和比例

- 实测法 – 单细胞测序
- 推测法 – bulk RNA-seq: 使用算法，对复杂的RNA测序表达谱中推断免疫细胞的构成比 – cibersort

基本原理：

- 反卷积 – 冲击响应+输出 – 输入(源信号)
	- 卷积：冲击响应+源信号 – 输出
	- cibersort:
		- 冲击响应 – 参考矩阵：标准单细胞中各类基因的表达量
			- 自变量维度：每个细胞类型
			- 因变量：总表达量
			- 样本点：每个基因
		- 输入 – 加权矩阵：不同细胞亚群水平
		- 输出 – 样本：各类基因组分表达量
- SVR
	- 类比于SVM: 二分类模型 – 分类算法
		- 找到一个超平面能够将数据分类，使其满足到最近的样本点距离最大
	- 实质 – 回归算法(真实值与预测值差距达到最小) – 构建符合样本规律的模型
		- 找到一个超平面，离最远的样本点距离最小 – 回归拟合
		- 样本点：支持向量
- 流程：对样本点采用SVR回归 – 得到 超平面+支持向量参数 – 运算得到样本中最有可能的细胞权重

### 网页实现

1. 准备矩阵
	- 参考矩阵(single cell reference matrix file)：
		- 行：不同基因
		- 列：不同细胞类型，有许多同名列
	- 表达矩阵(Phenotype classes file)
2. 表达矩阵对参考矩阵进行处理 — 签名矩阵
	- signature matrix file — 参考矩阵的处理，签名矩阵的生成
	- 配置：
		- create signature matrix — custom — select input data type: RNA-seq, scDNA-seq, 微阵列
		- 上传矩阵 — 参数配置
			- Kappa：签名矩阵最大条件数，默认为999
			- q-value：错误发现率(FDR)阈值，超过该值的认为显著表达，加入签名矩阵中
			- No. barcode genes：构建签名矩阵时，每种组织/细胞的最小和最大基因数
		- 运行 — 生成签名矩阵
		- 给出签名矩阵热图(可下载txt)
			- 同名列会被合并 — 规范化的签名矩阵
3. 签名矩阵+样本矩阵 — 细胞组分分析结果
	- 样本文件：样本基因表达谱 — 多个样本可以并行分析
		- 列：一个样本
		- 行：不同基因
	- 细胞组分分析：impute cell fractions(签名矩阵和样本的mixture文件) — 运行 — result
	- Result:
		- 行：一个样本
		- 列：一个细胞
		- p-value: 反映所有细胞子集，
		- R: 皮尔森相关系数，将实际的bulk RNA GEP与预测的bulk RNA GEP相比较得出。
		- RMSE: 实际 bulk RNA GEP 与预测的 bulk RNA GEP 的均方根误差
		- $r$：实际值与预测值的皮尔森相关系数
		- $RMSE$：实际值与预测值的均方根误差

CIBERSORTx 工作流涉及多种方法

1. 首先从少量的组织样本中获取不同细胞亚群的基因表达特征
2. 然后该结果系统用于组织样本的细胞丰度和基因表达分析

步骤：

1. 单个细胞或细胞亚群的转录组分析：
	- 获得特定细胞类型的标志基因矩阵，用于区分特定组织类型中特定的细胞子集；
2. 将特征矩阵应用于整个组织的 RNA 表达数据，以推断特定细胞类型的比例；
3. 代表性细胞类型的表达模式；
4. 从多组相关的组织样本中分析每种细胞类型的表达模式

### R代码实现

反卷积算法

- 实际：已知样品各基因表达浓度，又知各细胞类型的表达浓度，从而推测各样品中的细胞丰度 – T = C*P – 已知T和C求P
	- 表达矩阵(expression) – T (gene , sample)
	- 参考矩阵(reference) – C (gene , cell type)
		- 研究免疫浸润的情况下，使用白细胞特征矩阵(LM22)
	- 输出矩阵(result) – P (cell type , sample)
	- 背景噪音 – R
- 内层代码：
	- CoreAlg: SVM分析
	- doPerm: 调用核心函数CoreAlg，实现置换检验 – 产生背景R值
	- Main function: 打包运用到具体例子中

## 代码实现

### CoreAlg

参数传入

```R
#' Core algorithm
#' @param X cell-specific gene expression
#' @param y mixed expression per sample
#' @export
```

细胞特异性基因表达 x – LM22

单个样本的基因表达量 y

返回列表：

- 各种细胞比重(权重向量) w
- 相应模型参数 (RMSE , R)

二维矩阵LM22(m,n) – 将每一行映射到一个n维空间中 – 长度为m的向量

支持向量回归函数: $f(x)=w^Tx+b$

- 回归超平面 – 使靠超平面最远的样本点之间的间隔最小的那个超平面
	- SVR对间隔加以限制：所有的样本点，回归模型预测值与y真实值的偏差必须<=&epsilon;：
		- &epsilon;管道：
			- &epsilon;过小，出现异常点
			- &epsilon;过大，拟合度很差
		- 优化后的SVR不要求包含所有的样本点
			- nu值：不在&epsilon;管道的样本点
- 间隔上边界
- 间隔下边界

代码：

```R
CoreAlg <- function(x,y){
    #1. try different values of nu 调试不同nu值建立三种不同的模型
    svn_itor <- 3

    res <- function(i){
        if(i==1){nus <- 0.25}
        if(i==2){nus <- 0.5}
        if(i==3){nus <- 0.75}
        model<-e1071::svm(x,y,type="nu-regression",kernel="linear",nu=nus,scale=F)
        model
    }
    if(Sys.info()['sysname'] == 'windows') 
        out <- parallel::mclapply(1:svn_itor, res, mc.cores=1) 
    else
        out <- parallel::mclapply(1:svn_itor, res, mc.cores=svn_itor)
    
    #2. do cibersort 对coefs和SV处理得出每种细胞在样本中的比重
    t <- 1
    while(t <= svn_itor){
        weights = t(out[[t]]$coefs) %% out[[t]]$sv #回归直线参数 -- coefs, 确定回归直线的支持向量各个维度值 -- sv
        #此时的参数coefs并不是权重向量，这是由于svm函数会默认使用核函数将所有的输入变量x映射到另一个高维希尔伯特空间中进行后续计算
        #此时参与计算的是希尔伯特特征空间中的向量，因此保存的支持向量是映射到希尔伯特空间中的支持向量，参数coefs是希尔伯特空间中回归直线的斜率向量
        weights[which(weights<0)]<-0
        w<-weights/sum(weights) #对coefs和SV处理，将结果保存在w中
        u <- sweep(x2,MARGIN=2,w,'*')
        k <- apply(u,1,sum)
        nusvm[t] <- sqrt((mean((k-y)^2))) #每个模型预测值和实际值的均方差
        corrv[t] <- cor(k,y) #每个模型预测值和实际值的相关系数
        t <- t+1
    }
    
    #3. pick best model 选取均方根误差RMSE最小的作为最优模型
    rmses <- nusvm
    mn <- which.min(rmses)
    model <- out[[mn]]
    
    #4. get and normalize coefficients 将权重，均方根误差，相关系数保存并输出
    q <- t(model$coefs) %% model$SV
    q[which(q<0)] <- 0
    w <- (q/sum(q))

    mix_rmse <- rmses[mn]
    mix_r <- corrv[mn]

    newList <- list("w" = w, "mix_rmse" = mix_rmse, "mix_r" = mix_r)
}
```

### doPerm

参数传入

```R
#' do permutations
#' @param perm Number of permutations
#' @param X cell-specific gene expression
#' @param y mixed expression per sample
#' @export
```

置换检验，计算p值，产生背景R值

```R
doPerm <- function(perm,X,y){
    itor <-  1
    ylist <- as.list(data.matrix(y))
    dist <- matrix()
#从原来的数据中跟单个样本等长的数据，模拟新样本，进行CoreAlg计算
    while(itor <= perm){
        #print(itor)

        #random mixture sample命令产生模拟样本
        yr <- as.numeric(ylist[sample(length(ylist),dim(x)[1])])

        #standardize mixture  标准化模拟样本
        yr <- (yr - mean(yr))/sd(yr)

        #run CIBERSORT core algorithm
        result <- CoreAlg(X,yr)
        mix_r <- result$mix_r
        
        #store correlation 抽取出相关性系数
        if(itor == 1) {dist <- mix_r}
        else {dist <- rbind(dist,mix_r)}

        itor <- itor+1
    }
    
    #输出R值列表
    newlist <- list("dist" = dist)
}
```

### Main Function

参数传入

```R
#' Main functions
#' @param sig_matrix file path to gene expression from isolated cells
#' @param mixture_file heterogenous mixed expression
#' @param perm Number of permutations doperm中的重复次数
#' @param QN Perform quantile normalization or not (TRUE/FALSE) 要不要进行分数位归一化
#' @export
```

代码：

```R
# 1. 数据预处理
    #read in data 输入数据
    x <- read.table(sig_matrix, header=T, sep="\t", row.names=1, check.names=F)
    y <- read.table(mixture_file, header=T, sep="\t", check.names=F)
    y <- y[!duplicated(y[,1]),]
    rownames(y) <- y[,1]
    y <- y[,-1]
    x <- data.matrix(x)
    y <- data.matrix(y)

    #order matrix row by character order 矩阵按行名字母顺序排序
    x <- x[order(rownames(x)),]
    y <- y[order(rownames(y)),]

    p <- perm #number of permutations

    #anti-log if max < 50 in maxture file 指数运算
    if(max(y) < 50) {y <- 2^y}

    #quantile normalization of mixture file 分位数归一化，先对每个样本中基因表达量进行排序，计算每一个基因在所有样本中的平均值list，把平均值按照原来的基因表达量排序放进去
    if(QN == TRUE){
        tmpc <- colnames(y)
        tmpr <- rownames(y)
        y <- preprocessCore::normalize.quantiles(y)
        colnames(y) <- tmpc
        rownames(y) <- tmpr
    }

    #intersect/filter interesting genes 筛选感兴趣的基因
    xgns <- row.names(x)
    ygns <- row.names(y)
    yintx <- ygns %in% xgns
    y <- y[yintx,]
    xinty <- xgns %in% row.names(y)
    x <- x[xinty,]

    #standardize sig matrix 标准化
    x <- (x-mean(x)) / sd(as.vector(x))

# 2. empirical null distribution of correlation coefficients 求出各个样本的背景相关性系数分布
	if(p > 0) {nulldist <- sort(soPerm(p,x,y)$dist)} #doPerm并保存在nulldist中

# 3. 数据标准化，调用核心函数得到模型参数
    #建立输出变量
	header <- c('Mixture', colnames(x), "P-value", "Correlation", "RMSE")

    output <- matrix()
    itor <- 1
    mixtures <- dim(y)[2]
    pval <- 9999

    #iterate through mixture
    while(itor <= mixtures){
        y <- y[,itor]

        #standardize mixture
        y <- (y - mean(y))/sd(y)

        #run SVR core algorithm
        result <- CoreAlg(x,y)

# 4. 遍历所有样本
        #get results
        w <- result$w
        mix_r <- result$mix_rmse

        #calculate p-value
        if(p > 0) {pval <- 1 - (which.min(abs(nulldist - mix_r))/length(nulldist))}

        #print output 保存到输出变量中
        out <- c(colnames(y)[itor], w, pval, mix_r, mix_rmse)
        if(itor == 1) {output <- out}
        else {output <- rbind(output, out)}

        itor <- itor + 1

    }

## 5. save results 保存结果并输出
	write.table(rbind(header, output), file = "CIBERSORT-Results.txt", sep = "\t", row.names = F, col.names = F, quote = F)

    #return matrix object containing all results
    obj <- rbind(header, output)
    obj <- obj[,-1]
    obj <- obj[-1,]
    obj <- matrix(as.numeric(unlist(obj)), nrow = nrow(obj))
    rownames(obj) <- colnames(y)
    colnames(obj) <- c(colnames(x), "P-value", "Correlation", "RMSE")
    obj
```

## 支持向量机(SVM)

### 线性回归

线性模型：通过属性的线性组合来进行预测的函数，预测实值输出标记

- 一般向量形式$f(\mathbf{x})=\mathbf{w}^T\mathbf{x}+b$
- 最小二乘法 – 试图找到一条直线，使所有样本到直线上的欧氏距离之和最小 – 参数估计

分类任务：找一个单调可微函数，将分类任务的真实标记$y$与线性回归模型的预测值联系起来

- 二分类任务：将产生的预测值实值转为0/1
	- 单位阶跃函数 – 不连续
	- 对数几率函数(logistic function): $y=\frac{1}{1+e^{-z}}$ – Sigmoid函数
	- 变式: $\ln{\frac{y}{1-y}}=\mathbf{w}^T\mathbf{x}+b$
	- 几率：$\frac{y}{1-y}$ – 对数几率
	- 线性判别分析(LDA, Fisher判别) – 将所有的点都投影到回归直线上，使得两类点间隔最大
		- 类间散度矩阵 – $\mu$ – $S_w$ – 奇异值分解   $\mathbf{x}=\frac{\mathbf{x}-\mu}{\sigma}$
		- 类内散度矩阵 – $\Epsilon$(协方差) – $S_b$
		- 广义瑞利商(generalized Rayleigh quotient)
		- 多分类任务 – 全局散度矩阵

### 聚类

分析基因功能：

1. 将样本点都表现为gene表达量的距离点，即距离矩阵，来反映两个基因之间有什么样的距离。
2. 聚类的目的是将不同的基因分到不同的类中，距离是分类的一个依据 – 如何得到距离(距离就反映了所要的表达差距？)

我们是要怎么分类？我们的分类是对不同的表达数据进行分类：

- 变量：
	- 样本
	- gene表达量
	- 细胞类型
- 构建成的特征空间
- $y=2^y$

### SVM

特征空间上间隔最大的线性分类器 – 该线到最近的样本点距离最大 – 二维无法的话，就高维平面

基于训练集$D$ – 样本空间中 – 划分超平面：$\mathbf{w}^T\mathbf{x}+b=0$

- 法向量：$\mathbf{w}$ – 超平面方向

- 位移项：$b$ – 超平面与原点的距离

- 任意点$\mathbf{x}$到超平面$(\mathbf{w},b)$之间的距离：$r=\frac{|\mathbf{w}^T\mathbf{x}+b|}{\|\mathbf{w}\|}$

- 分类结果：
	$$
	\mathbf{w}^T\mathbf{x}_i+b\geq+1,\,\,\mathbf{y_i}=+1;
	\brace
	\mathbf{w}^T\mathbf{x}_i+b\leq-1,\,\,\mathbf{y_i}=-1.
	$$
	
- 支持向量：距离超平面最近的几个训练样本点使式中等号成立

	- 两个异类支持向量到超平面的距离之和为：$\gamma=\frac{2}{\|\mathbf{w}\|}$ – 间隔

	- 最大化分子间隔 – SVM基本型：
		$$
		\min_{\mathbf{w},b}{\frac{\|\mathbf{w}\|^2}{2}}
		\\
		s.t. \,y_i(\mathbf{w}^T\mathbf{x}_i+b)\geq1,\,i=1,2,...,m.
		$$

- 对偶问题：在求解上式获得大间隔划分超平面模型时，对凸二次规划问题求解 – 现成计算包

	- 使用 拉格朗日乘子 $\alpha_i\geq0$
		- 拉格朗日函数 – 求偏导并另偏导为0 – 对偶问题
		- 解出的拉格朗日乘子 – 训练样本$(\mathbf{x}_i,y_i)$ – 要满足KKT条件
		- 训练后，大部分样本不需保留，最终模型只与支持向量有关
	- SMO算法：固定其他参数，仅优化两个参数 – 高效

核函数：从原始空间映射到一个更高维的特征空间，使得样本在特征空间线性可分

- 理论：如果原始空间是有限维(属性有限)，一定存在高维特征空间使样本可分
- 特征向量：$\phi(\mathbf{x})$
- 对偶问题 – 内积：$\phi(\mathbf{x})^T\phi(\mathbf{x})$ – 难以计算
	- 核技巧/核函数：$\kappa(\mathbf{x_i},\mathbf{x_j})=\langle\phi(\mathbf{x_i}),\phi(\mathbf{x_j})\rangle=\phi(\mathbf{x})^T\phi(\mathbf{x})$ – 不必去计算高维，甚至无穷维特征空间中的内积 – 支持向量展式
		- 核矩阵$\mathbf{K}$总是半正定的 – 只要一个对称函数对应的核矩阵半正定，就能作为核函数使用 – 特征空间的好坏对支持向量机很重要
		- 常用核函数：

软间隔：允许某些样本不满足约束

正则化(regularization)：结构风险 – 经验风险 – 经验风险最小化

### SVR

所有样本点到这个超平面的距离最小，为得到一个  $f(\mathbf{x})=\mathbf{w}^T\mathbf{x}_i+b$  回归模型，使$f(x)$与$y$尽可能接近

- 假设我们能够容忍预测值与真实输出之间有$\epsilon$的偏差，且仅当差别绝对值大于$\epsilon$时才计算
- 考虑特征映射形式以及对偶问题，SVR公式可表示为：$f(\mathbf{x})=\sum_{i=1}^m(\widehat{\alpha}_i-\alpha_i)\kappa(\mathbf{x},\mathbf{x}_i)+b$

## CIBERSORTx

### 理论

反卷积：

SVR：

1. 自变量维度：签名矩阵的每个细胞类型
2. 因变量：每个样本的总表达量
3. 样本点：每个基因

### 算法



## CIBERSORT

### presentation

produceType_avgFiles.R

```
function: typeAvgFiles()

#read the signature matrix file and put each cell type values in a separate file. 
从签名矩阵中，根据细胞类型分类成单个文件
#Then, it calculaes the average value (between samples) for each cell type and return each in a separate file.


```

calculateAdjPval.R

```
function: pvalCalculation()

#read the separated file for each cell type, number of probes x number of samples, 
and calculate the pairwise adjusted p-value between cell types and return the ones for each cell type 
in a separate file (PvalB, PvalG, ...)
```

calculateEffectSize.R

```
function: effectSize()

#read the files with the average values for each cell types, and return the effect size matrixes for them
```

produceSigMat

```
function: makeSigMat

#read the Pvalue, effectSize and average value files.

#check the threshold for Pvalues and effect size apirwise between cell types for each probe

#every probe which passes both threshold will be save in signature matrix with its average (between samples)
values (between samples)
```

Merge_Mix_SigMat.R

```
# extract the signature matrix probes and their values from mixture Matrix 
(example: LM22, merge ExampleMixtures-GEPs ), to be used for modeling
```

svr.R

```
# Read the signature matrix and the mixture data (for the probes from signature matrix), 
and build the model using e1071 package.

(scale = F, type = "nu-regression")
```

nnlm.R

```
# Read the signature matrix and the mixture data (for the probes from signature matrix), 
and build the model using nnls package.
```

comPlotType

```
# reads the observed data and the predicted data from a single file (format important) amd 
make the scatterplot of predicted versus observed for each cell type.
```

 

 ## 展示

1. CIBERSORTx开发自CIBERSORT。
2. CIBERSORT算法在**反卷积算法的运用于细胞推断**这一领域具有重要的意义，它运用支持向量回归(SVR)得到回归模型：$f(\mathbf{x})=\mathbf{w}^T\mathbf{x}_i+b$，我们引用2015年发布的CIBERSORT的R包(v1.03)，
	1. **CIBERSORT**
		1. 利用自带signature文件**LM22** –基本准确，但会忽略一些特殊表型
	2. **CIBERSORTx**
		1. 通过**单细胞****RNA-seq(scRNA-seq)数据**构建**专属signature
		2. 各免疫细胞marker基因
		3. 能够推测**各免疫细胞特征基因表达谱**
		4. **单细胞参考表达矩阵**（Single cell reference matrix file）（行名为基因名，列名为细胞名；用途：制作标签矩阵Signature matrix file）
		5. **标签矩阵**（Signature matrix file）（行名为基因名（更少），列名为细胞名（归纳好），用途：为混池矩阵（Mixture file)服务，相当于LM22）
		6. **混池矩阵**（Mixture file）（你需要计算免疫细胞比例的bulk测序，行名为基因名，列名为样本名，就是普通的表达矩阵）

 


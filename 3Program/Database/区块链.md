[[BioInformaticsNote/3Program/Database/README|README]]

区块链：是一种去中心化的数据库

# 概念

概念：
- 背景：
	- 互联网上的贸易，几乎都需要借助可资信赖的第三方信用机构来处理电子支付信息。这类系统仍然内生性地受制于“基于信用的模式”。
	- 区块链技术是构建比特币区块链网络与交易信息加密传输的基础技术。它基于密码学原理而不基于信用，使得任何达成一致的双方直接支付，从而不需要第三方中介的参与。
- 定义：区块链是一个分布式账本，一种通过去中心化、去信任的方式集体维护一个可靠数据库的技术方案。
	- 从数据的角度来看：区块链是一种几乎不可能被更改的分布式数据库。这里的“分布式”不仅体现为数据的分布式存储，也体现为数据的分布式记录（即由系统参与者共同维护）。
	- 从技术的角度来看：区块链并不是一种单一的技术，而是多种技术整合的结果。这些技术以新的结构组合在一起，形成了一种新的数据记录、存储和表达的方式。
- 基础架构：应用层、激励层、共识层、网络层、数据层
- 关键概念：
	- 
	- 公钥：相当于账号，全网每个节点都有一个公钥，别人付钱时都是付给这个公钥
	- 私钥：相当于你的账号的身份证明，私钥可以解开公钥加密的数据，说明付款方确实是你。私钥必须妥善保存，一旦丢失，就丢失了账户内的所有数据也就是所有财产。
	- 交易：节点之间发生的支付就是交易
	- 区块：
		- 一段时间内的所有交易会打包成一个区块
		- 这个区块还会记录上一个区块的hash值，使得上一个区块不可篡改
		- 区块会包含时间戳，这个时间戳解决了“双花”问题，也就是一个货币不能被支付两次，区块链技术中承认时间戳在前的交易的有效性。
	- 区块链：由于每个区块都有上一个区块的hash值，造成每生成一个新区快，就会造成老区块的不可篡改，从而形成全部数据的不可篡改。
	- 记账权/挖矿：
		- 所谓记账权，也就是比特币中的挖矿，其实就是把从上次区块生成后到现在为止的所有交易打包再打上时间戳，向全网公示，51%的节点确认区块有效则该区块就加入到区块链的末端，成为账本的一部分。
		- 由于不存在中心，所以记账权是全网争夺的，大家通过计算一道密码学难题，谁先解出来，并获得全网共识，谁就争夺到记账权。
		- 因为要鼓励大家参与记账，所以争夺到记账权会有报酬，就是若干比特币。
	- 共识机制：就是所有分布式节之间怎么达成共识，通过算法来生成和更新数据，去认定一个记录的有效性，这既是认定的手段，也是防止篡改的手段。以比特币为例，采用的是“工作量证明”（Proof Of Work，简称POW）。工作量是需要算力的，通过工作量证明，有效的防止了篡改和伪造，因为如果要达到伪造和篡改的工作量，大概需要巨量成本的算力。

区块链的特征：区块链是一个分布式账本，一种通过去中心化,去信任的方式集体维护一个可靠数据库的技术方案
- 开放、共识：任何人都可以参与到区块链网络，每一台设备都能作为一个节点，每个节点都允许获得一份完整的数据库拷贝。节点间基于一套共识机制，通过竞争计算共同维护整个区块链。任一节点失效，其余节点仍能正常工作。
- 去中心化、去信任：区块链由众多节点共同组成一个端到端的网络，不存在中心化的设备和管理机构。节点之间数据交换通过数字签名技术进行验证，无需互相信任，只要按照系统既定的规则进行，节点之间不能也无法欺骗其它节点。
- 交易透明、双方匿名：区块链的运行规则是公开透明的，所有的数据信息也是公开的，因此每一笔交易都对所有节点可见。由于节点与节点之间是去信任的，因此节点之间无需公开身份，每个参与的节点都是匿名的。
- 信息不可篡改、可追溯：单个甚至多个节点对数据库的修改无法影响其他节点的数据库，除非能控制整个网络中超过51%的节点同时修改，这几乎不可能发生。区块链中的每一笔交易都通过密码学方法与相邻两个区块串联，因此可以追溯到任何一笔交易的前世今生。
- 集体维护
- 可靠数据库

区块链分类：
- 公有链：无官方组织及管理机构，无中心服务器，参与的节点按照系统规则自由接入网络、不受控制，节点间基于共识机制开展工作。
- 私有链：建立在某个企业内部，系统的运作规则根据企业要求进行设定，修改甚至是读取权限仅限于少数节点，同时仍保留着区块链的真实性和部分去中心化的特性。
- 联盟链：由若干机构联合发起，介于公有链和私有链之间，兼具部分去中心化的特性

# 区块链的核心技术

区块链技术：区块链技术是由多方共同记录和维护的一个分布式数据库，该数据库通过哈希索引形成一种链状结构，其中数据的记录和维护通过密码学技术来保护其完整性，使得任何一方难以篡改、抵赖、造假。
- 核心技术：密码学原理、共识机制、分布式存储
- 特点：
	- 分布式：分布式核算和存储，共享交易账本，共同维护
	- 可靠数据库：参与节点拥有完整数据库拷贝
	- 安全可信：采用非对称密码学对交易签名，使交易不能被伪造；哈希算法保证交易不能被篡改；工作量证明抵御攻击
	- 自治性：交易条件和状态内嵌，不需要认为干预

哈希函数：一种将输入的字节数据散列化的不可逆的函数，例如SHA256相当于一个消息的缩写
- 特点：
	- 相同的数据输入将得到相同的结果
	- 输入的数据一旦稍有变化，就会得到一个千差万别的结果，结果无法预测
	- 正向计算(由数据计算其对应的Hash值)十分容易
	- 逆向计算(俗称“破解”由Hash值计算其对应的数据)相当困难
- 哈希函数用于区块链，需要有非常高的安全标准，需要满足密码安全级别。要使哈希函数达到密码安全
- SHA-256 (Secure Hash Algorithm 256)：比特币世界中所采用的哈希算法——SHA256
	- SHA算法大致分为如下三个步骤：
		1. 常量初始化
		2. 信息预处理
		3. 计算消息摘要：过程为
			- 将消息分解成n个512-bit大小的块
			- n次迭代运算

Merkel Tree：一种哈希二叉树可以快速校验大规模数据的完整性。在比特币网络中，Merkel Tree被用来记录区块中所有的交易信息，最终生成这个区块所有交易信息的一个统一哈希值，任何一笔交易信息的改变都会使得整个树改变
- 工作原理：非叶子节点value的计算方法是将该节点与所有子节点进行组合，然后对组合结果进行Hash计算所得出的哈希值

加密算法：
- 对称加密
- 非对称加密：
	- 原理为
		- 公钥：信息的真实性
		- 私钥：信息的安全性
			- 私钥向全网证明“自己是自己”：全网节点虽然无法看到我的密码是什么，但要让他们都知道我确实拥有这一密码。
	- 常见的非对称加密算法包括RSA、Elgamal、D-H、ECC（椭圆曲线加密算法）等

数字签名：数字签名涉及到一个哈希函数、发送者的公钥、发送者的私钥。
- 数字签名有两个作用：
	- 确定消息确实是由发送方签名并发出来的
	- 数字签名能确定消息的完整性
- 工作原理：发送报文时，发送方用一个哈希函数从报文文本中生成报文摘要，然后用自己的私钥对摘要进行加密，加密后的摘要将作为报文的数字签名和报文一起发送给接收方，接收方首先用与发送方一样的哈希函数从接收到的原始报文中计算出报文摘要，接着再用发送方的公钥来对报文附加的数字签名进行解密，如果这两个摘要相同、那么接收方就能确认该数字签名是发送方的。

共识机制：共识机制是指所有分布式节之间怎么达成共识，通过算法来生成和更新数据，去认定一个记录的有效性。指区块链系统中实现不同节点之间建立信任、获取权益的数学算法 。
- pPoW (工作量证明 Proof of Work)：依赖机器进行数学运算来获取记账权，所有节点都平等的计算一个数学难题，谁最先找到答案谁就获得记账权。全网算力形成区块链防火墙，降低被攻击风险。
- pPoS (权益证明 Proof of Stake)：股份制，通过持有币的数量和时间决定记账权。
- pDPoS (股份授权证明 Delegate Proof of Stake)：民主议会制，通过选举决定记账权，被选中的代表在一定时间内依次具有记账权。
- pPBFT (实用拜占庭容错 Practical Byzantine Fault Tolerance)：拜占庭容错算法，通过数学算法实现，不需要代币，33%容错。

基础架构：
- 激励层：发行机制和激励机制，以比特币为例：
	- 比特币最开始由系统奖励给那些创建新区块的矿工，该奖励大约每四年减半。刚开始每记录一个新区块，奖励矿工50个比特币，该奖励大约每四年减半。依次类推，到公元2140年左右，新创建区块就没有系统所给予的奖励了。届时比特币全量约为2100万个，这就是比特币的总量，所以不会无限增加下去。
	- 另外一个激励的来源则是交易费。新创建区块没有系统的奖励时，矿工的收益会由系统奖励变为收取交易手续费。例如，你在转账时可以指定其中1%作为手续费支付给记录区块的矿工。如果某笔交易的输出值小于输入值，那么差额就是交易费，该交易费将被增加到该区块的激励中。只要既定数量的电子货币已经进入流通，那么激励机制就可以逐渐转换为完全依靠交易费，那么就不必再发行新的货币。
- 合约层：智能合约
	- 智能合约是一组情景应对型的程序化规则和逻辑，是通过部署在区块链上的去中心化、可信共享的脚本代码实现的。
	- 通常情况下，智能合约经各方签署后，以程序代码的形式附着在区块链数据上，经P2P网络传播和节点验证后记入区块链的特定区块中。智能合约封装了预定义的若干状态及转换规则、触发合约执行的情景、特定情景下的应对行动等。区块链可实时监控智能合约的状态，并通过核查外部数据源、确认满足特定触发条件后激活并执行合约。

# 区块链的数据结构

区块链的数据结构：
- 区块链以区块为单位组织数据。
- 全网所有的交易记录都以交易单的形式存储在全网唯一的区块链中。

区块链中每个区块体的结构
- 区块头：
	- 版本号，标示软件及协议的相关版本信息
	- 父区块哈希值，引用的区块链中父区块头的哈希值，通过这个值每个区块才首尾相连组成了区块链，并且这个值对区块链的安全性起到了至关重要的作用
	- Merkle 根，这个值是由区块主体中所有交易的哈希值再逐级两两哈希计算出来的一个数值，主要用于检验一笔交易是否在这个区块中存在
	- 时间戳，记录该区块产生的时间，精确到秒
	- 难度值，该区块相关数学题的难度目标
	- 随机数(Nonce)，记录解密该区块相关数学题的答案的值
- 区块形成过程：在当前区块加入区块链后，所有矿工就立刻开始下一个区块的生成工作
	- •把在本地内存中的交易信息记录到区块体中
	- 在区块主体中生成此区块中所有交易信息的Merkle树，把树根的值保存在区块头中
	- 把上一个刚刚生成的区块的区块头的数据通过SHA256算法生成一个哈希值填入到当前区块的父哈希值中
	- 把当前时间保存在时间戳字段中
	- 通过共识算法来确定新区块(矿工争夺记账权利)，在比特币中的共识算法是工作量证明算法POW，进行POW的过程也叫挖矿
- 共识机制与挖矿
	- 在没有中心控制的情况下，在互相没有信任基础的个体之间就交易的合法性需要达成共识
	- 比特币中使用PoW（Proof of Work，工作量证明），原理如下：
		- 先打包交易构建区块再挖矿
			- `版本号|父区块哈希|merkle树根|时间戳|难度系数|Nonce`
			- `Eg.目标难度：0x00000000003A300C000000`
			- 找到Nonce，使Hash值小于目标值（eg.Nonce++）
		- 区块验证
			- 验证该区块满足挖矿难度
			- 交易数据符合规范
		- 旷工奖励：
			- 50BTC->25BTC->12.5BTC
			- 交易费
- Bitcoin的区块数据结构：
	- block header
	- transaction data

# 区块链网络和交易过程

 区块链网络
- P2P网络：P2P网络，又称点对点技术，是没有中心服务器、依靠用户群交换信息的互联网体系。与有中心服务器的中央网络系统不同，对等网络的每个用户端既是一个节点，也有服务器的功能。
	- 特点
		- 去中心化：网络中的资源和服务分散在所有结点上，信息的传输和服务的实现都直接在结点之间进行，可以无需中间环节和服务器的介入。
		- 健壮性：P2P架构天生具有耐攻击、高容错的优点。由于服务是分散在各个结点之间进行的，部分结点或网络遭到破坏对其它部分的影响很小。
- 节点网络：任何机器都可以运行一个完整的比特币节点
	- 一个完整的比特币节点包括如下功能：
		- 钱包，允许用户在区块链网络上进行交易
		- 完整区块链，记录了所有交易历史，通过特殊的结构保证历史交易的安全性，并且用来验证新交易的合法性
		- 矿工，通过记录交易及解密数学题来生成新区块，如果成功可以赚取奖励
		- 路由功能，把其它节点传送过来的交易数据等信息再传送给更多的节点

区块链技术
- 交易流程：
	1. 交易生成：A -> B
	2. 交易传播
	3. 挖矿
	4. 整个网络节点验证
	5. 交易形成
- 以比特币为例了解区块链交易过程：
	1. 新交易创建：所有者A利用他的私钥对前一次交易（比特货来源）和下一位所有者B签署一个数字签名，并将这个签名附加在这枚货币的末尾，制作成交易单
		- 要点：B以公钥作为接收方地址
	2. 交易通过P2P网络传播：A将交易单广播至全网，比特币就发送给了B，每个节点都将收到的交易信息纳入一个区块中
		- 要点：对B而言，该枚比特币会即时显示在比特币钱包中，但直到区块确认成功后才可用。目前一笔比特币从支付到最终确认成功，得到6个区块确认之后才能真正确认到帐
	3. 交易验证：每个节点通过解一道数学难题，从而去获得创建新区块权利，并争取得到比特币的奖励（新比特币会在此过程中产生）
		- 要点：节点反复尝试寻找一个数值，使得将该数值、区块链中最后一个区块的Hash值以及交易单三部分送入SHA256算法后能计算出散列值X（256位）满足一定条件（比如前20位均为0），即找到数学难题的解。由此可见，答案并不唯一
	4. 验证结果通过P2P网络传播：当一个节点找到解时，它就向全网广播该区块记录的所有盖时间戳交易，并由全网其他节点核对
		- 要点：时间戳用来证实特定区块必然于某特定时间是的确存在的。比特币网络采取从5个以上节点获取时间，然后取中间值的方式作为时间戳。
	5. 交易写入账本：全网其他节点核对该区块记账的正确性，没有错误后他们将在该合法区块之后竞争下一个区块，这样就形成了一个合法记账的区块链。
		- 要点：每个区块的创建时间大约在10分钟。随着全网算力的不断变化，每个区块的产生时间会随算力增强而缩短、随算力减弱而延长。其原理是根据最近产生的2016年区块的时间差（约两周时间），自动调整每个区块的生成难度（比如减少或增加目标值中0的个数），使得每个区块的生成时间是10分钟。

# 区块链的应用及前景展望

为什么要有区块链：
- 现状：
	- 中央系统虚拟货币（中心化机构掌控）；异地灾备、云存储
	- 中心化的来源：为满足市场参与者对信息的需求，而信息的买卖造就了“中介费”（成本）
	- 创新源于对现实问题的解决——中心化
- 中心化的弊端：
	- 信息分散在各中心手中，打通成本非常大
	- 信息要按照中心化机构的体系要求进行运作（全球汇款）
	- 内部人员的篡改，黑客攻击，自然灾害等
- 去中心化：
	- 信息去中心化：
		- 第一代互联网成功实现了信息去中心化：生活信息、知识、新闻、资料…
		- 互联网的起点是TCP/IP 协议（执行一个网络上所有节点统一格式对等传输信息的开放代码）——信息分享与实时更新
		- 互联网就是消灭那个价值很低、成本很高的（信息）供应链：它开放、互联、对等、全球化、去中心化
	- 信用去中心化：
		- 没有“中介”的信用背书很难实现陌生人间的信用交易：银行，结算机构，淘宝…
		- 中心化带来的成本与日俱增
- 区块链技术：在互联网中创造一种技术，这种技术在无法保证人们互相信任的前提下，还可以从事价值交换的活动

区块链发展历程：
- 区块链1.0：可编程货币：去中心化的数字支付系统，无障碍的价值转换；
	- 代表：比特币区块链（电子货币，去中心化交易）
- 区块链2.0：可编程金融：股票、清算、私募股权等众多金融领域；
	- 代表：以太坊区块链（智能合约、数字资产）
- 区块链3.0：可编程社会：公证、仲裁、审计、物流、医疗、邮件等领域。

区块链应用：三个阶段（领域），从 2008年的比特币开始，区块链经历了可编程货币、可编程金融与可编程社会三大应用时代，其应用范围逐步扩展到社会生活的方方面面
- 可编程货币：数字货币
	- 目前区块链技术最广泛、最成功的运用是以比特币为代表的数字货币
	- 自比特币诞生以后，已经陆续出现了数百种的数字货币，围绕着数字货币生成、存储、交易形成了较为庞大的产业链生态。以比特币为例，参与机构主要可分为基础设施、交易平台、ICO融资服务、区块链综合服务等四类
- 可编程金融：
	- 优点
		- 减少中间环节，降低交易成本，提高交易效率，简化大量手工金融服务流程；
		- 提升数据安全性。
	- 例子：
		- 微众银行联合上海华瑞银行推出微粒贷机构间对账平台，这也是国内首个在生产环境中运行的银行业联盟链应用场景
		- 跨境支付
		- 数字票据
		- 资产证券化
		- 保险业务
- 可编程社会
	- 医疗：
		- 病例数据掌握者是患者，而不是某个医院或第三方机构
		- 方便病人可以跨医院就医，并且可以做健康规划
	- 能源管理
	- 区块链 + IP版权&文化娱乐
	- 区块链 + 公共服务&教育
	- 供应链：查看货物的来源地，并且跟踪物流信息，防止造假
	- 共享经济
	- 公益
	- 政府税收监管
	- 征信管理

区块链展望：
- 从需求端来看，金融、 医疗、公证、通信、供应链、域名、投票等领域都开始意识到区块链的重要性并开始尝试将技术与现实社会对接。
- 从投资端来看，区块链的投资资金供给逐步上升， 风投的投资热情也不断高涨，投资密度越来越大，供给端的资金供给有望推动技术的进一步发展。
- 从市场应用来看，区块链能成为一种市场工具，帮助社会削减平台成本，让中间机构成为过去；区块链将促使公司现有业务模式重心的转移，有望加速公司的发展。
- 从底层技术来看，区块链有望促进数据记录、数据传播及数据存储管理方式的转型；区块链本身更像一种互联网底层的开源式协议，在不远的将来会触动甚至最后彻底取代现有互联网的底层基础协议。
- 从社会结构来看，区块链技术有望将法律与经济融为一体，彻底颠覆原有社会的监管模式；组织形态会因其而发生改变，区块链也许最终会带领人们走向分布式自治的社会。

